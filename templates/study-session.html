<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyStacks - Study {{ deck.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: var(--gradient-top);
        }

        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--space-cadet);
            backdrop-filter: blur(10px);
            padding: 10.5px 21px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }

        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 10.5px;
        }

        .logo {
            font-family: var(--font-rubik);
            font-size: 16.8px;
            font-weight: 600;
            color: var(--white);
            text-shadow: 0 2px 4px var(--transparent-black-30);
        }

        .book-emoji {
            font-size: 19.6px;
            background: var(--transparent-white-15);
            padding: 5.6px 7px;
            border-radius: 8.4px;
            backdrop-filter: blur(5px);
            border: 1px solid var(--transparent-white-20);
        }

        .welcome-text {
            font-family: var(--font-poppins);
            font-size: 14px;
            color: var(--white);
            text-shadow: 0 2px 4px var(--transparent-black-30);
        }

        .content-container {
            margin-top: 80px;
            padding: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .back-btn {
            display: inline-block;
            padding: 8px 16px;
            background: var(--transparent-white-15);
            color: var(--white);
            text-decoration: none;
            border-radius: 8px;
            font-family: var(--font-poppins);
            font-size: 14px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: var(--transparent-white-20);
        }

        .study-card {
            background: var(--transparent-white-15);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 40px;
            border: 1px solid var(--transparent-white-20);
            text-align: center;
            margin-bottom: 30px;
        }

        .deck-title {
            font-family: var(--font-rubik);
            font-size: 24px;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 30px;
        }

        .card-question {
            font-family: var(--font-rubik);
            font-size: 20px;
            font-weight: 500;
            color: var(--white);
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-answer {
            font-family: var(--font-poppins);
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 30px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--transparent-white-10);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--transparent-white-20);
        }

        .show-answer-btn {
            background: var(--tiffany-blue);
            color: var(--space-cadet);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-family: var(--font-poppins);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .show-answer-btn:hover {
            background: var(--aquamarine);
            transform: translateY(-2px);
        }

        .answer-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .correct-btn {
            background: #4ade80;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-family: var(--font-poppins);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .incorrect-btn {
            background: #f87171;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-family: var(--font-poppins);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .correct-btn:hover, .incorrect-btn:hover {
            transform: translateY(-2px);
        }

        .progress-info {
            font-family: var(--font-poppins);
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="top-bar-left">
            <div class="book-emoji" onclick="window.location.href='/logged-in'" style="cursor: pointer;">üìö</div>
            <div class="logo" onclick="window.location.href='/logged-in'" style="cursor: pointer;">StudyStacks</div>
        </div>
        <div class="welcome-text" style="display:flex; align-items:center; gap:12px;">
            <span style="opacity:0.9;">{{ user.userinfo.email if user and user.userinfo else '' }}</span>
            <button onclick="window.location.href='/logout'" style="background: var(--transparent-white-15); color: var(--white); border: 1px solid var(--transparent-white-20); padding: 6px 12px; border-radius: 6px; font-family: var(--font-poppins); font-size: 12px; cursor: pointer; z-index: 1001; position: relative; transition: all 0.3s ease;" onmouseover="this.style.background='var(--transparent-white-20)'" onmouseout="this.style.background='var(--transparent-white-15)'">Logout</button>
        </div>
    </div>
    
    <div class="content-container">
        <a href="/study" class="back-btn">‚Üê Back to Study</a>
        
        <div class="study-card">
            <div class="deck-title">{{ deck.name }}</div>
            <div class="progress-info">Card <span id="current-card">1</span> of {{ deck.flashcards|length }}</div>
            
            <div class="card-question" id="question">
                {{ deck.flashcards[0].question }}
            </div>
            
            <div class="card-answer hidden" id="answer">
                {{ deck.flashcards[0].answer }}
            </div>
            
            <button class="show-answer-btn" id="show-answer" onclick="showAnswer()">Show Answer</button>
            
            <div class="answer-buttons hidden" id="answer-buttons">
                <button class="incorrect-btn" onclick="submitAnswer(false)">Incorrect</button>
                <button class="correct-btn" onclick="submitAnswer(true)">Correct</button>
            </div>
        </div>
    </div>

    <script>
        let currentCardIndex = 0;
        const cards = {{ deck.flashcards | tojson }};
        const deckIndex = {{ deck_index }};
        
        function showAnswer() {
            document.getElementById('answer').classList.remove('hidden');
            document.getElementById('show-answer').classList.add('hidden');
            document.getElementById('answer-buttons').classList.remove('hidden');
        }
        
        function submitAnswer(correct) {
            // Send answer to server
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/study/${deckIndex}/answer`;
            
            const cardIndexInput = document.createElement('input');
            cardIndexInput.type = 'hidden';
            cardIndexInput.name = 'card_index';
            cardIndexInput.value = currentCardIndex;
            
            const correctInput = document.createElement('input');
            correctInput.type = 'hidden';
            correctInput.name = 'correct';
            correctInput.value = correct;
            
            form.appendChild(cardIndexInput);
            form.appendChild(correctInput);
            document.body.appendChild(form);
            
            // Move to next card or finish
            currentCardIndex++;
            if (currentCardIndex < cards.length) {
                nextCard();
            } else {
                // Study session complete
                form.submit();
            }
        }
        
        function nextCard() {
            const card = cards[currentCardIndex];
            document.getElementById('current-card').textContent = currentCardIndex + 1;
            document.getElementById('question').textContent = card.question;
            document.getElementById('answer').textContent = card.answer;
            
            // Reset UI
            document.getElementById('answer').classList.add('hidden');
            document.getElementById('show-answer').classList.remove('hidden');
            document.getElementById('answer-buttons').classList.add('hidden');
        }
    </script>
</body>
</html>
